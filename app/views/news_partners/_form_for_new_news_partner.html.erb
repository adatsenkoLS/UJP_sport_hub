<% if !NewsPartner.first %>

    <div class="news_partners_empty">
        <%= image_tag("news_partners/warning-grey.png", size: "120")%>
        <p id="news_partners_empty_info">News Partners page is empty!</p>
        <p id="news_partners_empty_prop">You can <%= link_to "Add New Partners", news_partners_new_path, class:"news_partners_empty_link" %> here and manage them.</p>
    </div>

<% else %>


    <div class="container_news_partners_table">
        <table class="news_partners_table">
            <thead>
                <tr id="news_partners_table_header">
                    <th>NEWS PARTNERS NAME</th>
                    <th>STATUS<%= image_tag("news_partners/filter.png", size: "20", class: "news_partners_sort_icon")%></th>
                    <th>ACTIONS</th>
                </tr>
            </thead>
        </table>


    <% news_partners = NewsPartner.all.sort_by {|x| x.id } %>
    <% news_partners.each do |news_partner| %>
        <table class="news_partners_table">
            <tbody>
                    <tr class="news_partners_table_data"> 

                        <td class="news_partners_table_title">
                            <span class="bi bi-plus", onclick='show_hide_row(<%= news_partner.id%>);'></span><%= news_partner.title %>
                        </td>

                        <td class="news_partners_status_form">
                            <div class="form-check form-switch">                        
                                <input type="checkbox" class="form-check-input" id="change_status_checkbox" onclick='change_status(<%= news_partner.id%>)'>
                                <% if news_partner.active
                                    c = "Acitve"
                                else
                                    c = "Inactive"
                                end %>
                                <span class=<%= c %>><%= c%></span>
                            </div>  
                        </td>

                        <td class="news_partners_table_actions">
                            <span onclick='show_hide_row(<%= news_partner.id%>);'><%= image_tag("news_partners/pencil.png", size: "20", class: "news_partners_edit_icon")%></span>
                            <%= image_tag("news_partners/delete.png", size: "20", class: "news_partners_delete_icon", onClick: "delete_row(#{news_partner.id})") %>
                        </td>

                    </tr>
                    <%= content_tag :tr, class:"hidden_row", id: news_partner.id do %>
                    <td>
                        <%= render "form_for_edit_news_partners" , news_partner: news_partner%>
                    </td>
                    <% end %>
            </tbody>
        </table>
    <% end %>
    </div>
<% end %>

    <% if flash[:already_exist] %>
    <div class="flash">
        <div class="flash_icon_div">
            <%= image_tag("news_partners/warning-red.png", class: "flash_icon") %>
        </div>
        <div class="flash_text">
            <p class="flash_header">Something went wrong!</p>
            <p>News Partner with this name already exist!</p>
        </div>
    </div>
    <% end %>

    <% if flash[:delete] %>
    <div class="flash">
        <div class="flash_icon_div">
            <%= image_tag("news_partners/success.png", class: "flash_icon") %>
        </div>
        <div class="flash_text">
            <p class="flash_header">Deleted!</p>
            <p>News Partner was successfully deleted!</p>
        </div>
    </div>
    <% end %>

    <% if flash[:update] %>
    <div class="flash">
        <div class="flash_icon_div">
            <%= image_tag("news_partners/success.png", class: "flash_icon") %>
        </div>
        <div class="flash_text">
            <p class="flash_header">Updated!</p>
            <p>News Partner was successfully updated!</p>
        </div>
    </div>
    <% end %>

    <% if flash[:add] %>
    <div class="flash">
        <div class="flash_icon_div">
            <%= image_tag("news_partners/success.png", class: "flash_icon") %>
        </div>
        <div class="flash_text">
            <p class="flash_header">Added!</p>
            <p>News Partner was successfully added!</p>
        </div>
    </div>
    <% end %>

<script>
    function show_hide_row(row) {
        $("#"+row).toggle();
    }

    function delete_row(row_id) {
        event.preventDefault();
        let form = document.createElement("form");
        form.method = "POST";   
        form.action = `/news_partners/delete/${row_id}`;
        form.style = "display: none;";
        let methodInput = document.createElement("input");
        methodInput.value = "delete";
        methodInput.name = "_method]    ";
        form.appendChild(methodInput);
        document.body.appendChild(form);
        form.submit(); 
    }
    
    function change_status(row_id) {
        event.preventDefault();
        let form = document.createElement("form");
        form.method = "PATCH";   
        form.action = `/news_partners/${row_id}`;
        form.style = "display: none;";
        let methodInput = document.createElement("input");
        methodInput.value = "change_status";
        methodInput.name = "_method]    ";
        form.appendChild(methodInput);
        document.body.appendChild(form);
        form.submit(); 
    }
</script>